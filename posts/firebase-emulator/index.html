<!doctype html><html lang=ja><head><meta charset=utf-8><title>Firebase Emulator を使ってローカル開発を捗らせる。</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-151064248-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-151064248-1')</script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://shota.coffee/index.xml title=shotaCoffee><meta name=twitter:card content="summary"><meta name=twitter:title content="Firebase Emulator を使ってローカル開発を捗らせる。"><meta name=twitter:description content="前提 - firebase のプロジェクトの初期化が終わっていること - firebase 8.1.2 以降 - firebase-tools 7.8.0 以降 - Java 1.8 以降 - node 8.0 以降 Local Emulator Suite を構成する firebase init emulators 以下のように firebase.json に emulator に関する設定"><link rel=stylesheet href=https://shota.coffee/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://shota.coffee/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme'),storedTheme=localStorage.getItem('dark-mode-storage');storedTheme==='dark'?darkTheme.disabled=!1:storedTheme==='light'&&(darkTheme.disabled=!0)</script><script src=https://shota.coffee/js/main.bundle.js></script><script src=https://shota.coffee/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.82.0"></head><body><header><nav class=navbar><div class=nav><a href=https://shota.coffee/ class=nav-logo><img src=https://shota.coffee/images/logo.svg width=50 height=50 alt=Logo></a><ul class=nav-links></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>Firebase Emulator を使ってローカル開発を捗らせる。</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><h2 id=前提>前提</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>firebase</span> <span style=color:#960050;background-color:#1e0010>のプロジェクトの初期化が終わっていること</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>firebase</span> <span style=color:#ae81ff>8.1</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#ae81ff>2</span> <span style=color:#960050;background-color:#1e0010>以降</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>firebase-tools</span> <span style=color:#ae81ff>7.8</span><span style=color:#960050;background-color:#1e0010>.</span><span style=color:#ae81ff>0</span> <span style=color:#960050;background-color:#1e0010>以降</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>Java</span> <span style=color:#ae81ff>1.8</span> <span style=color:#960050;background-color:#1e0010>以降</span>
<span style=color:#960050;background-color:#1e0010>-</span> <span style=color:#960050;background-color:#1e0010>node</span> <span style=color:#ae81ff>8.0</span> <span style=color:#960050;background-color:#1e0010>以降</span>
</code></pre></div><h2 id=local-emulator-suite-を構成する>Local Emulator Suite を構成する</h2><ul><li><code>firebase init emulators</code></li></ul><p>以下のように firebase.json に emulator に関する設定が追加される</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;emulators&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
    <span style=color:#f92672>&#34;firestore&#34;</span>: {
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#e6db74>&#34;8080&#34;</span>
    },
    <span style=color:#f92672>&#34;ui&#34;</span>: {
      <span style=color:#f92672>&#34;enabled&#34;</span>: <span style=color:#66d9ef>true</span>,      <span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>Default</span> <span style=color:#960050;background-color:#1e0010>is</span> <span style=color:#960050;background-color:#1e0010>`true`</span>
      <span style=color:#f92672>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;localhost&#34;</span>,
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>4000</span>          <span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>If</span> <span style=color:#960050;background-color:#1e0010>unspecified</span>, <span style=color:#960050;background-color:#1e0010>see</span> <span style=color:#960050;background-color:#1e0010>CLI</span> <span style=color:#960050;background-color:#1e0010>log</span> <span style=color:#960050;background-color:#1e0010>for</span> <span style=color:#960050;background-color:#1e0010>selected</span> <span style=color:#960050;background-color:#1e0010>port</span>
    },
    <span style=color:#f92672>&#34;auth&#34;</span>: {
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#e6db74>&#34;9099&#34;</span>
    },
    <span style=color:#f92672>&#34;functions&#34;</span>: {
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#e6db74>&#34;5001&#34;</span>
    },
    <span style=color:#f92672>&#34;database&#34;</span>: {
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#e6db74>&#34;9000&#34;</span>
    },
    <span style=color:#f92672>&#34;pubsub&#34;</span>: {
      <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#e6db74>&#34;8085&#34;</span>
    }
  }
</code></pre></div><ul><li>生成された port を みに行くように firebase を initialize しているところなどで記述を追加する</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>firebase</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;firebase&#39;</span>;

<span style=color:#75715e>// 使うサービスによってここのパラメータはいらないものもあります。
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>config</span> <span style=color:#f92672>=</span> {
  <span style=color:#a6e22e>apiKey</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_API_KEY&#39;</span>,
  <span style=color:#a6e22e>authDomain</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_AUTH_DOMAIN&#39;</span>,
  <span style=color:#a6e22e>databaseURL</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_DATABASE_URL&#39;</span>,
  <span style=color:#a6e22e>projectId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_PROJECT_ID&#39;</span>,
  <span style=color:#a6e22e>storageBucket</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_STORAGE_BUCKET&#39;</span>,
  <span style=color:#a6e22e>messagingSenderId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_MESSAGING_SENDER_ID&#39;</span>,
  <span style=color:#a6e22e>appId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_APP_ID&#39;</span>,
  <span style=color:#a6e22e>measurementId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;YOUR_MEASUREMENT_ID&#39;</span>
};

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>firebase</span>.<span style=color:#a6e22e>initializeApp</span>(<span style=color:#a6e22e>config</span>);

<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>auth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>auth</span>();
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>db</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>database</span>();
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>firestore</span>();

<span style=color:#75715e>/*
</span><span style=color:#75715e> * ここで簡単に環境を切り替えるようにしていますが、
</span><span style=color:#75715e> * 起動時に環境変数を用いて切り替える方でもいいです。
</span><span style=color:#75715e> */</span> 
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>isEmulating</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>hostname</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;localhost&#39;</span>;

<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isEmulating</span>) {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Firestore using local emulator&#39;</span>);
  <span style=color:#75715e>// fire store の host の向き先、ここは設定した port を指定してください
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>store</span>.<span style=color:#a6e22e>settings</span>({
    <span style=color:#a6e22e>host</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;localhost:8080&#39;</span>,
    <span style=color:#a6e22e>ssl</span>: <span style=color:#66d9ef>false</span>
  });
  <span style=color:#75715e>// realtime database の向き先、ここは設定した port を指定してください
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>db</span>.<span style=color:#a6e22e>useEmulator</span>(<span style=color:#e6db74>&#39;localhost&#39;</span>, <span style=color:#ae81ff>9000</span>);
  <span style=color:#75715e>// authentication  の向き先、ここは設定した port を指定してください
</span><span style=color:#75715e></span>  <span style=color:#a6e22e>auth</span>.<span style=color:#a6e22e>useEmulator</span>(<span style=color:#e6db74>&#39;http://localhost:9099/&#39;</span>);
}
</code></pre></div><p>整理したデフォルト port 一覧はこちら</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=color:#f92672>|</span> <span style=color:#ae81ff>9099</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>firebase</span> <span style=color:#a6e22e>Auth</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> <span style=color:#ae81ff>8080</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>firestore</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> <span style=color:#ae81ff>9000</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>database</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> <span style=color:#ae81ff>5000</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>hosting</span> <span style=color:#f92672>|</span>
<span style=color:#f92672>|</span> <span style=color:#ae81ff>8081</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>firebase</span> <span style=color:#a6e22e>ui</span> <span style=color:#f92672>|</span>
</code></pre></div><h2 id=起動する>起動する</h2><p><code>firebase emulators:start</code></p><p>自分の場合は npm script にこんな感じで追加してます。</p><p><code>"firebase-local": "firebase emulators:start"</code></p><p>すると <a href=http://localhost:8081/><code>http://localhost:8081/</code></a> でローカルの firebase が立ち上がります</p><p><img src=images/Untitled.png alt=images/Untitled.png></p><p>あとは、いつも通り開発するだけです。</p><p>これのおかげで本番データを気にせず、ローカル開発ができるようになりました。👏</p><h3 id=参考>参考</h3><ul><li><a href=https://firebase.google.com/docs/emulator-suite>https://firebase.google.com/docs/emulator-suite</a></li><li><a href=https://firebase.google.com/docs/emulator-suite/install_and_configure>https://firebase.google.com/docs/emulator-suite/install_and_configure</a></li><li><a href=https://gist.github.com/jaytaylor/b14716671ae6a8cd057bd6d849670238>https://gist.github.com/jaytaylor/b14716671ae6a8cd057bd6d849670238</a></li></ul><div class=blog-tags><a href=https://shota.coffee/tags/firebase/>Firebase</a>&nbsp;</div></article></div><footer><div class=social-icons><a href=https://twitter.com/shota_coffee name=Twitter><em class="fab fa-twitter"></em></a>&nbsp;&ndash;&nbsp;
<a href=https://github.com/shotaCoffee name=GitHub><em class="fab fa-github"></em></a>&nbsp;&ndash;&nbsp;
<a href=https://www.facebook.com/shotaCoffee name=facebook><em class="fab fa-facebook"></em></a>&nbsp;&ndash;&nbsp;
<a href=https://www.linkedin.com/in/shota-murakami-40362011b/ name=linkedin><em class="fab fa-linkedin"></em></a></div><div class=container><p class="credits copyright"><a href=https://shota.coffee/about></a>&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://shota.coffee/>shotaCoffee</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p></div></footer></body></html>