<!doctype html><html>
<head>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=twitter:image:src content="https://shota.coffee/images/og/default-og-img.png">
<meta property="og:image" content="https://shota.coffee/images/og/default-og-img.png">
<meta property="og:title" content="codesign">
<meta property="og:site_name" content="codesign">
<meta name=description content="shotaCoffeeのブログです">
<meta property="og:description" content="shotaCoffeeのブログです">
<meta property="og:image" content="https://shota.coffee/images/og/firebase-emulator.png">
<meta name=twitter:image:src content="https://shota.coffee/images/og/firebase-emulator.png">
<meta property="og:title" content="Firebase Emulator を使ってローカル開発を捗らせる。 | codesign">
<meta property="og:site_name" content="Firebase Emulator を使ってローカル開発を捗らせる。 | codesign">
<meta name=description content>
<meta property="og:description" content>
<meta property="og:locale" content="ja">
<meta property="og:image:width" content="600">
<meta property="og:image:height" content="315">
<meta property="og:type" content="website">
<meta name=twitter:site content="@shota_coffee">
<meta name=twitter:card content="summary_large_image">
<meta property="fb:app_id" content="2709602549147832">
<link rel=icon type=image/x-icon href=/favicon.ico>
<link rel=stylesheet href=https://shota.coffee/styles/main.css>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151064248-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-151064248-1')</script>
<meta charset=utf-8>
<title>Firebase Emulator を使ってローカル開発を捗らせる。</title>
</head>
<body>
<header class=header>
<nav class=navigation>
<ul>
<li>
<a href=/>
<img src=/images/logo.svg alt=codesign>
</a>
</li>
</ul>
<h1>codesign</h1>
</nav>
</header>
<div class=post>
<h2>Firebase Emulator を使ってローカル開発を捗らせる。</h2>
<div class=post-meta>
<div class=posted>2020.12.07</div>
<div class=categories>
<ul>
<li class=text-small><a href=/tags/Firebase/>Firebase</a></li>
</ul>
</div>
</div>
<h2 id=前提>前提</h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=err>-</span> <span class=err>firebase</span> <span class=err>のプロジェクトの初期化が終わっていること</span>
<span class=err>-</span> <span class=err>firebase</span> <span class=mf>8.1</span><span class=err>.</span><span class=mi>2</span> <span class=err>以降</span>
<span class=err>-</span> <span class=err>firebase-tools</span> <span class=mf>7.8</span><span class=err>.</span><span class=mi>0</span> <span class=err>以降</span>
<span class=err>-</span> <span class=err>Java</span> <span class=mf>1.8</span> <span class=err>以降</span>
<span class=err>-</span> <span class=err>node</span> <span class=mf>8.0</span> <span class=err>以降</span>
</code></pre></div><h2 id=local-emulator-suite-を構成する>Local Emulator Suite を構成する</h2>
<ul>
<li><code>firebase init emulators</code></li>
</ul>
<p>以下のように firebase.json に emulator に関する設定が追加される</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=s2>&#34;emulators&#34;</span><span class=err>:</span> <span class=p>{</span>
    <span class=nt>&#34;firestore&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=s2>&#34;8080&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;ui&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;enabled&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>      <span class=err>//</span> <span class=err>Default</span> <span class=err>is</span> <span class=err>`true`</span>
      <span class=nt>&#34;host&#34;</span><span class=p>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span>
      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=mi>4000</span>          <span class=err>//</span> <span class=err>If</span> <span class=err>unspecified</span><span class=p>,</span> <span class=err>see</span> <span class=err>CLI</span> <span class=err>log</span> <span class=err>for</span> <span class=err>selected</span> <span class=err>port</span>
    <span class=p>},</span>
    <span class=nt>&#34;auth&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=s2>&#34;9099&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;functions&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=s2>&#34;5001&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;database&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=s2>&#34;9000&#34;</span>
    <span class=p>},</span>
    <span class=nt>&#34;pubsub&#34;</span><span class=p>:</span> <span class=p>{</span>
      <span class=nt>&#34;port&#34;</span><span class=p>:</span> <span class=s2>&#34;8085&#34;</span>
    <span class=p>}</span>
  <span class=p>}</span>
</code></pre></div><ul>
<li>生成された port を みに行くように firebase を initialize しているところなどで記述を追加する</li>
</ul>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=kr>import</span> <span class=nx>firebase</span> <span class=kr>from</span> <span class=s1>&#39;firebase&#39;</span><span class=p>;</span>

<span class=c1>// 使うサービスによってここのパラメータはいらないものもあります。
</span><span class=c1></span><span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=p>{</span>
  <span class=nx>apiKey</span><span class=o>:</span> <span class=s1>&#39;YOUR_API_KEY&#39;</span><span class=p>,</span>
  <span class=nx>authDomain</span><span class=o>:</span> <span class=s1>&#39;YOUR_AUTH_DOMAIN&#39;</span><span class=p>,</span>
  <span class=nx>databaseURL</span><span class=o>:</span> <span class=s1>&#39;YOUR_DATABASE_URL&#39;</span><span class=p>,</span>
  <span class=nx>projectId</span><span class=o>:</span> <span class=s1>&#39;YOUR_PROJECT_ID&#39;</span><span class=p>,</span>
  <span class=nx>storageBucket</span><span class=o>:</span> <span class=s1>&#39;YOUR_STORAGE_BUCKET&#39;</span><span class=p>,</span>
  <span class=nx>messagingSenderId</span><span class=o>:</span> <span class=s1>&#39;YOUR_MESSAGING_SENDER_ID&#39;</span><span class=p>,</span>
  <span class=nx>appId</span><span class=o>:</span> <span class=s1>&#39;YOUR_APP_ID&#39;</span><span class=p>,</span>
  <span class=nx>measurementId</span><span class=o>:</span> <span class=s1>&#39;YOUR_MEASUREMENT_ID&#39;</span>
<span class=p>};</span>

<span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>firebase</span><span class=p>.</span><span class=nx>initializeApp</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>

<span class=kr>export</span> <span class=kr>const</span> <span class=nx>auth</span> <span class=o>=</span> <span class=nx>app</span><span class=p>.</span><span class=nx>auth</span><span class=p>();</span>
<span class=kr>export</span> <span class=kr>const</span> <span class=nx>db</span> <span class=o>=</span> <span class=nx>app</span><span class=p>.</span><span class=nx>database</span><span class=p>();</span>
<span class=kr>export</span> <span class=kr>const</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>app</span><span class=p>.</span><span class=nx>firestore</span><span class=p>();</span>

<span class=cm>/*
</span><span class=cm> * ここで簡単に環境を切り替えるようにしていますが、
</span><span class=cm> * 起動時に環境変数を用いて切り替える方でもいいです。
</span><span class=cm> */</span> 
<span class=kr>const</span> <span class=nx>isEmulating</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>hostname</span> <span class=o>===</span> <span class=s1>&#39;localhost&#39;</span><span class=p>;</span>

<span class=k>if</span> <span class=p>(</span><span class=nx>isEmulating</span><span class=p>)</span> <span class=p>{</span>
  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Firestore using local emulator&#39;</span><span class=p>);</span>
  <span class=c1>// fire store の host の向き先、ここは設定した port を指定してください
</span><span class=c1></span>  <span class=nx>store</span><span class=p>.</span><span class=nx>settings</span><span class=p>({</span>
    <span class=nx>host</span><span class=o>:</span> <span class=s1>&#39;localhost:8080&#39;</span><span class=p>,</span>
    <span class=nx>ssl</span>: <span class=kt>false</span>
  <span class=p>});</span>
  <span class=c1>// realtime database の向き先、ここは設定した port を指定してください
</span><span class=c1></span>  <span class=nx>db</span><span class=p>.</span><span class=nx>useEmulator</span><span class=p>(</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span> <span class=mi>9000</span><span class=p>);</span>
  <span class=c1>// authentication  の向き先、ここは設定した port を指定してください
</span><span class=c1></span>  <span class=nx>auth</span><span class=p>.</span><span class=nx>useEmulator</span><span class=p>(</span><span class=s1>&#39;http://localhost:9099/&#39;</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>整理したデフォルト port 一覧はこちら</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=o>|</span> <span class=mi>9099</span> <span class=o>|</span> <span class=nx>firebase</span> <span class=nx>Auth</span> <span class=o>|</span>
<span class=o>|</span> <span class=mi>8080</span> <span class=o>|</span> <span class=nx>firestore</span> <span class=o>|</span>
<span class=o>|</span> <span class=mi>9000</span> <span class=o>|</span> <span class=nx>database</span> <span class=o>|</span>
<span class=o>|</span> <span class=mi>5000</span> <span class=o>|</span> <span class=nx>hosting</span> <span class=o>|</span>
<span class=o>|</span> <span class=mi>8081</span> <span class=o>|</span> <span class=nx>firebase</span> <span class=nx>ui</span> <span class=o>|</span>
</code></pre></div><h2 id=起動する>起動する</h2>
<p><code>firebase emulators:start</code></p>
<p>自分の場合は npm script にこんな感じで追加してます。</p>
<p><code>"firebase-local": "firebase emulators:start"</code></p>
<p>すると <a href=http://localhost:8081/><code>http://localhost:8081/</code></a> でローカルの firebase が立ち上がります</p>
<p><img src=images/Untitled.png alt=images/Untitled.png></p>
<p>あとは、いつも通り開発するだけです。</p>
<p>これのおかげで本番データを気にせず、ローカル開発ができるようになりました。👏</p>
<h3 id=参考>参考</h3>
<ul>
<li><a href=https://firebase.google.com/docs/emulator-suite>https://firebase.google.com/docs/emulator-suite</a></li>
<li><a href=https://firebase.google.com/docs/emulator-suite/install_and_configure>https://firebase.google.com/docs/emulator-suite/install_and_configure</a></li>
<li><a href=https://gist.github.com/jaytaylor/b14716671ae6a8cd057bd6d849670238>https://gist.github.com/jaytaylor/b14716671ae6a8cd057bd6d849670238</a></li>
</ul>
</div>
<section class=profile-wrap>
<div class=profile>
<h2 class=profile-heading>Profile</h2>
<div class=profile-contents>
<div class=profile-avatar>
<img src=/images/avatar.jpg alt=shotaCoffee>
</div>
<div class=profile-description>
<h2>shotaCoffee</h2>
<p>Frontend Engineer</p>
<p>音楽とコーヒーが好きなフロントエンド中心のエンジニア</p>
<ul class=profile-sns>
<li>
<a href=https://twitter.com/shota_coffee rel=noopener target=_blank>
<img src=/images/logo-twitter.svg alt=Twitter>
</a>
</li>
<li>
<a href=https://github.com/shotaCoffee rel=noopener target=_blank>
<img src=/images/logo-github.svg alt=GitHub>
</a>
</li>
</ul>
</div>
</div>
</div>
</section>
<footer class=footer>
<p>
<a href=/>codesign</a>
</p>
<ul class=footer-navigation>
<li>
<a href=/privacy-policy>プライバシーポリシー</a>
</li>
</ul>
</footer>
</body>
</html>